@using G5_MovieTicketBookingSystem.DTOs.MovieBookingPlan

<section class="book-section bg-one">
    <div class="container">
        <form class="ticket-search-form two">
            <!-- Chọn Thành Phố -->
            <div class="form-group">
                <div class="thumb">
                    <img src="assets/images/ticket/city.png" alt="ticket">
                </div>
                <span class="type">City</span>
                <select class="select-bar" @onchange="HandleCityChange">
                    <option value="">Select a city</option>
                    @foreach (var city in cities)
                    {
                        <option value="@city">@city</option>
                    }
                </select>
            </div>

            <!-- Chọn Ngày -->
            <div class="form-group">
                <div class="thumb">
                    <img src="assets/images/ticket/date.png" alt="ticket">
                </div>
                <span class="type">Date</span>
                <select class="select-bar" @onchange="HandleDateChange">
                    @foreach (var date in availableDates)
                    {
                        <option value="@date.ToString("yyyy-MM-dd")">@date.ToString("dd/MM/yyyy")</option>
                    }
                </select>
            </div>

            <!-- Chọn Rạp -->
            <div class="form-group">
                <div class="thumb">
                    <img src="assets/images/ticket/cinema.png" alt="ticket">
                </div>
                <span class="type">Cinema</span>
                <select class="select-bar" @onchange="HandleCinemaChange">
                    <option value="">Select a cinema</option>
                    @foreach (var cinema in cinemas)
                    {
                        <option value="@cinema">@cinema</option>
                    }
                </select>
            </div>

            <!-- Chọn Trải Nghiệm -->
            <div class="form-group">
                <div class="thumb">
                    <img src="assets/images/ticket/exp.png" alt="ticket">
                </div>
                <span class="type">Experience</span>
                <select class="select-bar" @onchange="HandleExperienceChange">
                    <option value="">Select an experience</option>
                    @foreach (var experience in experiences)
                    {
                        <option value="@experience">@experience</option>
                    }
                </select>
            </div>
        </form>
    </div>
</section>

@code {
    // Lấy dữ liệu từ component cha
    [Parameter] public IEnumerable<string> cities { get; set; } = Array.Empty<string>();
    [Parameter] public IEnumerable<DateTime> availableDates { get; set; } = Array.Empty<DateTime>();
    [Parameter] public IEnumerable<string> cinemas { get; set; } = Array.Empty<string>();
    [Parameter] public IEnumerable<string> experiences { get; set; } = Array.Empty<string>();
    [Parameter] public EventCallback<MovieShowtimeFilterDto> OnFilterChanged { get; set; }




    public MovieShowtimeFilterDto movieShowtimeFilterDto = new MovieShowtimeFilterDto();

    // Hàm xử lý khi chọn thành phố
    public async Task HandleCityChange(ChangeEventArgs e)
    {
        movieShowtimeFilterDto.City = e.Value.ToString();
        Console.WriteLine(e.Value.ToString());
        await OnFilterChanged.InvokeAsync(movieShowtimeFilterDto);
    }
    public async Task HandleDateChange(ChangeEventArgs e)
    {
        movieShowtimeFilterDto.ShowDate = DateTime.Parse(e.Value.ToString());
        await OnFilterChanged.InvokeAsync(movieShowtimeFilterDto);
    }
    public async Task HandleCinemaChange(ChangeEventArgs e)
    {
        movieShowtimeFilterDto.CinemaName = e.Value.ToString();
        Console.WriteLine(e.Value.ToString());
        await OnFilterChanged.InvokeAsync(movieShowtimeFilterDto);
    }
    public async Task HandleExperienceChange(ChangeEventArgs e)
    {
        movieShowtimeFilterDto.ExperienceType = e.Value.ToString();
        Console.WriteLine(e.Value.ToString());
        await OnFilterChanged.InvokeAsync(movieShowtimeFilterDto);
    }





}
