@page "/payment-success"
@layout MainLayout

@using G5_MovieTicketBookingSystem.Models.VNPAY
@inject IHttpContextAccessor HttpContextAccessor

<h3>Chi tiết thanh toán</h3>

@if (paymentInfo != null)
{
    <p><strong>Loại đơn hàng:</strong> @paymentInfo.OrderType</p>
    <p><strong>Số tiền:</strong> @paymentInfo.Amount.ToString("N0") VND</p>
    <p><strong>Mô tả:</strong> @paymentInfo.OrderDescription</p>
    <p><strong>Khách hàng:</strong> @paymentInfo.Name</p>

    <a href="/" class="btn btn-primary">Quay lại trang chủ</a>
}
else
{
    <p>Không tìm thấy thông tin thanh toán.</p>
}

@code {
    private PaymentInformationModel? paymentInfo;

    protected override void OnInitialized()
    {
        var queryCollection = HttpContextAccessor.HttpContext?.Request.Query;
        if (queryCollection != null)
        {
            try
            {
                string orderInfo = queryCollection["vnp_OrderInfo"];
                string name = "Khách hàng";

                // Tách tên khách hàng từ `vnp_OrderInfo`
                if (!string.IsNullOrEmpty(orderInfo) && orderInfo.Contains("-"))
                {
                    name = orderInfo.Split("-")[0].Trim();
                }

                paymentInfo = new PaymentInformationModel
                    {
                        OrderType = "movie_ticket",
                        Amount = Convert.ToDouble(queryCollection["vnp_Amount"]) / 100,
                        OrderDescription = orderInfo,
                        Name = name
                    };
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Lỗi xử lý thông tin thanh toán: {ex.Message}");
            }
        }
    }
}
